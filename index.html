<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dexter's Lab - Ultimate Edition 🔪</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d0000 50%, #000000 100%);
            min-height: 100vh;
            color: #ff6b6b;
            overflow-x: hidden;
            position: relative;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000000 0%, #1a0000 50%, #2d0000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            font-size: 5rem;
            color: #ff0000;
            text-shadow: 0 0 50px rgba(255, 0, 0, 1);
            margin-bottom: 30px;
            animation: logoGlow 2s ease infinite;
        }

        @keyframes logoGlow {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.5); }
        }

        .loading-bar {
            width: 400px;
            height: 20px;
            background: rgba(139, 0, 0, 0.3);
            border: 3px solid #8b0000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff4444);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 12px;
        }

        .loading-tip {
            color: #cccccc;
            font-size: 1.2rem;
            text-align: center;
            max-width: 500px;
            margin-top: 20px;
            opacity: 0.9;
        }

        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #1a0000;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #8b0000, #ff0000);
            border-radius: 10px;
            border: 2px solid #4a0000;
        }

        .autosave-indicator {
            position: fixed;
            top: 25px;
            left: 25px;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #8b0000;
            border-radius: 15px;
            padding: 15px 20px;
            color: #4caf50;
            font-size: 1rem;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.4s ease;
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.5);
        }

        .autosave-indicator.show {
            opacity: 1;
        }

        .health-container {
            position: fixed;
            bottom: 25px;
            left: 25px;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #8b0000;
            border-radius: 15px;
            padding: 15px 20px;
            z-index: 1000;
            min-width: 200px;
        }

        .health-bar {
            width: 180px;
            height: 25px;
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid #8b0000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff4444);
            width: 100%;
            transition: width 0.3s ease;
            border-radius: 12px;
        }

        .health-text {
            color: #ff4444;
            font-size: 0.9rem;
            text-align: center;
        }

        .inventory-container {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #8b0000;
            border-radius: 15px;
            padding: 20px;
            z-index: 1000;
            width: 300px;
            max-height: 200px;
            overflow-y: auto;
        }

        .inventory-title {
            color: #ff4444;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(255, 68, 68, 0.7);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .inventory-slot {
            width: 60px;
            height: 60px;
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid #8b0000;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .inventory-slot:hover {
            border-color: #ff4444;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }

        .inventory-slot.has-item {
            background: rgba(255, 68, 68, 0.4);
            border-color: #ff4444;
        }

        .inventory-item-icon {
            font-size: 1.5rem;
            margin-bottom: 2px;
        }

        .inventory-item-count {
            font-size: 0.7rem;
            color: #ffff00;
            font-weight: bold;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            min-height: 100vh;
            padding: 25px;
            gap: 30px;
            align-items: start;
        }

        .shop-container {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(139, 0, 0, 0.7);
            border: 3px solid #8b0000;
            max-height: calc(100vh - 50px);
            overflow-y: auto;
        }

        .shop-tabs {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }

        .shop-tab {
            flex: 1;
            padding: 10px;
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid #8b0000;
            border-radius: 8px;
            color: #cccccc;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .shop-tab.active {
            background: rgba(255, 68, 68, 0.4);
            border-color: #ff4444;
            color: #ff4444;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }

        .shop-tab:hover {
            border-color: #ff0000;
        }

        .shop-content {
            display: none;
        }

        .shop-content.active {
            display: block;
        }

        .shop-title {
            font-size: 2.2rem;
            color: #ff4444;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.9);
        }

        .game-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 25px;
            gap: 20px;
        }

        .click-section {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(139, 0, 0, 0.7);
            border: 3px solid #8b0000;
            display: flex;
            justify-content: center;
            align-items: center;
            order: 1;
        }

        .click-button {
            width: 300px;
            height: 300px;
            border: 5px solid #8b0000;
            border-radius: 25px;
            background: linear-gradient(45deg, #2a0000, #4a0000, #2a0000);
            font-size: 6rem;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 20px 50px rgba(139, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .click-button:hover {
            transform: scale(1.15);
            box-shadow: 0 25px 60px rgba(139, 0, 0, 0.9);
            border-color: #ff0000;
        }

        .click-button:active {
            transform: scale(0.95);
            animation: stabEffect 0.3s ease;
        }

        @keyframes stabEffect {
            0% { transform: scale(0.95); }
            50% { transform: scale(1.2) rotate(5deg); }
            100% { transform: scale(0.95); }
        }

        .critical-hit {
            border-color: #ffff00 !important;
            box-shadow: 0 0 80px rgba(255, 255, 0, 1) !important;
            animation: criticalPulse 1s ease;
            background: linear-gradient(45deg, #4a0000, #ffff00, #4a0000) !important;
        }

        @keyframes criticalPulse {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.4) rotate(10deg); }
            75% { transform: scale(1.2) rotate(-5deg); }
        }

        .game-header {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(139, 0, 0, 0.7);
            border: 3px solid #8b0000;
            text-align: center;
            max-width: 600px;
            width: 100%;
            order: 2;
        }

        .title {
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 0 0 30px rgba(255, 0, 0, 0.9);
            color: #ff4444;
        }

        .quote {
            color: #999;
            font-style: italic;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .save-load-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .save-btn, .load-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #8b0000, #ff0000);
            border: 3px solid #ff4444;
            border-radius: 12px;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
        }

        .save-btn:hover, .load-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 0, 0, 0.6);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat {
            background: rgba(139, 0, 0, 0.4);
            padding: 15px;
            border-radius: 12px;
            border: 3px solid #8b0000;
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .stat:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(139, 0, 0, 0.6);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff4444;
            text-shadow: 0 0 15px rgba(255, 68, 68, 0.7);
        }

        .target-section {
            background: rgba(139, 0, 0, 0.4);
            padding: 15px;
            border-radius: 12px;
            border: 3px solid #8b0000;
            margin: 15px 0;
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.4);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .notifications-container {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(139, 0, 0, 0.7);
            border: 3px solid #8b0000;
            max-height: calc(100vh - 50px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .achievements-panel {
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(139, 0, 0, 0.1);
            border-radius: 12px;
            border: 2px solid #8b0000;
        }

        .achievements-panel::-webkit-scrollbar {
            width: 8px;
        }

        .achievements-panel::-webkit-scrollbar-track {
            background: rgba(139, 0, 0, 0.2);
            border-radius: 8px;
        }

        .achievements-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #8b0000, #ff0000);
            border-radius: 8px;
        }

        .achievements-title {
            font-size: 1.6rem;
            color: #ff4444;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(255, 68, 68, 0.7);
        }

        .boss-alerts-panel {
            min-height: 250px;
        }

        .boss-alerts-title {
            font-size: 1.6rem;
            color: #ff4444;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(255, 68, 68, 0.7);
        }

        .upgrades {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .upgrade {
            background: rgba(139, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #8b0000;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upgrade:hover {
            border-color: #ff0000;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.6);
            background: rgba(139, 0, 0, 0.5);
        }

        .upgrade.affordable {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.4);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.4);
        }

        .upgrade.unaffordable {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .upgrade-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ff4444;
            text-shadow: 0 0 10px rgba(255, 68, 68, 0.7);
        }

        .upgrade-description {
            color: #cccccc;
            font-size: 0.8rem;
            margin: 5px 0;
            font-style: italic;
        }

        .upgrade-cost {
            color: #ffaa44;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 170, 68, 0.7);
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .item {
            background: rgba(139, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #8b0000;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .item:hover {
            border-color: #ff0000;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.6);
            background: rgba(139, 0, 0, 0.5);
        }

        .item.affordable {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.4);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.4);
        }

        .item.unaffordable {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .item-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ff4444;
            text-shadow: 0 0 10px rgba(255, 68, 68, 0.7);
        }

        .item-description {
            color: #cccccc;
            font-size: 0.8rem;
            margin: 5px 0;
            font-style: italic;
        }

        .item-cost {
            color: #ffaa44;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 170, 68, 0.7);
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .achievement {
            background: linear-gradient(45deg, #8b0000, #ff0000, #8b0000);
            padding: 12px;
            border-radius: 10px;
            margin: 8px 0;
            animation: achievementSlide 1s ease;
            border: 3px solid #ff4444;
            box-shadow: 0 0 25px rgba(255, 68, 68, 0.7);
            text-shadow: 0 0 8px rgba(0, 0, 0, 1);
            font-weight: bold;
            font-size: 0.9rem;
        }

        @keyframes achievementSlide {
            0% { 
                transform: translateX(100%) scale(0.8); 
                opacity: 0; 
            }
            100% { 
                transform: translateX(0%) scale(1); 
                opacity: 1; 
            }
        }

        .boss-encounter-alert {
            background: linear-gradient(45deg, #8b0000, #ff0000, #8b0000);
            border: 4px solid #ff4444;
            border-radius: 15px;
            padding: 20px;
            margin: 12px 0;
            text-align: center;
            box-shadow: 0 0 40px rgba(255, 0, 0, 1);
            animation: alertPulse 2s ease infinite;
        }

        @keyframes alertPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 40px rgba(255, 0, 0, 1); 
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 0 60px rgba(255, 0, 0, 1.3); 
            }
        }

        .boss-name {
            font-size: 1.5rem;
            color: #ffff00;
            text-shadow: 0 0 20px rgba(255, 255, 0, 1);
            margin-bottom: 10px;
        }

        .boss-alert-btn {
            padding: 10px 20px;
            background: linear-gradient(45deg, #ff0000, #ff4444);
            border: 3px solid #ffff00;
            border-radius: 8px;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
            margin: 0 5px;
        }

        .boss-alert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 255, 0, 0.6);
        }

        .hard-victim-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #8b0000, #ff0000, #8b0000);
            border: 5px solid #ff4444;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 0 60px rgba(255, 0, 0, 1.5);
            z-index: 5000;
            animation: hardVictimPulse 1.5s ease infinite;
            min-width: 350px;
        }

        @keyframes hardVictimPulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1); 
                box-shadow: 0 0 60px rgba(255, 0, 0, 1.5); 
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.1); 
                box-shadow: 0 0 100px rgba(255, 0, 0, 2); 
            }
        }

        .hard-victim-name {
            font-size: 2rem;
            color: #ffff00;
            text-shadow: 0 0 30px rgba(255, 255, 0, 1.5);
            margin-bottom: 15px;
            animation: nameFlicker 0.8s ease infinite;
        }

        @keyframes nameFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .spam-button {
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff0000, #ff4444, #ff6666);
            border: 4px solid #ffff00;
            border-radius: 12px;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(255, 255, 0, 0.8);
        }

        .spam-button:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(255, 255, 0, 1);
        }

        .spam-button:active {
            transform: scale(0.95);
        }

        .boss-arena {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0000 50%, #2a0000 100%);
            display: none;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            z-index: 9999;
            padding: 20px;
        }

        .boss-arena.active {
            display: flex;
        }

        .battle-box {
            width: 600px;
            height: 400px;
            border: 4px solid #ff4444;
            background: rgba(0, 0, 0, 0.8);
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }

        .player-soul {
            width: 20px;
            height: 20px;
            background: #ff0000;
            border: 2px solid #ffff00;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 3px;
            transition: all 0.1s ease;
            z-index: 100;
        }

        .boss-projectile {
            position: absolute;
            z-index: 50;
            animation: projectileGlow 1s ease infinite;
        }

        @keyframes projectileGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .trinity-symbol {
            width: 30px;
            height: 30px;
            background: linear-gradient(45deg, #ffff00, #ffaa00, #ffff00);
            border: 3px solid #ff0000;
            border-radius: 8px;
            box-shadow: 
                0 0 15px rgba(255, 255, 0, 0.8),
                inset 0 0 10px rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .trinity-symbol::before {
            content: '✦';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff0000;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 0, 0, 1);
        }

        .ice-shard {
            width: 25px;
            height: 40px;
            background: linear-gradient(180deg, #ffffff, #88ddff, #00aaff);
            border: 2px solid #0088ff;
            border-radius: 0;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            box-shadow: 
                0 0 20px rgba(0, 170, 255, 0.8),
                inset 0 0 15px rgba(255, 255, 255, 0.5);
            position: relative;
        }

        .ice-shard::before {
            content: '';
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 15px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), transparent);
            border-radius: 50% 50% 0 0;
        }

        .fire-ball {
            width: 35px;
            height: 35px;
            background: radial-gradient(circle at 30% 30%, #ffff00, #ff8800, #ff0000, #aa0000);
            border: 2px solid #ffaa00;
            border-radius: 50%;
            box-shadow: 
                0 0 25px rgba(255, 0, 0, 1),
                0 0 40px rgba(255, 100, 0, 0.7),
                inset 0 0 15px rgba(255, 255, 0, 0.4);
            position: relative;
            animation: fireFlicker 0.3s ease infinite alternate;
        }

        @keyframes fireFlicker {
            0% { 
                box-shadow: 
                    0 0 25px rgba(255, 0, 0, 1),
                    0 0 40px rgba(255, 100, 0, 0.7),
                    inset 0 0 15px rgba(255, 255, 0, 0.4);
            }
            100% { 
                box-shadow: 
                    0 0 35px rgba(255, 50, 0, 1),
                    0 0 50px rgba(255, 150, 0, 0.9),
                    inset 0 0 20px rgba(255, 255, 100, 0.6);
            }
        }

        .fire-ball::before {
            content: '🔥';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            animation: fireRotate 1s linear infinite;
        }

        @keyframes fireRotate {
            0% { transform: translate(-50%, -50%) rotate(0deg) scale(0.8); }
            50% { transform: translate(-50%, -50%) rotate(180deg) scale(1.2); }
            100% { transform: translate(-50%, -50%) rotate(360deg) scale(0.8); }
        }

        .undertale-buttons {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .undertale-btn {
            padding: 15px 30px;
            font-size: 1.5rem;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            background: linear-gradient(45deg, #8b0000, #ff0000);
            border: 4px solid #ff4444;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            min-width: 120px;
            position: relative;
            overflow: hidden;
        }

        .undertale-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }

        .undertale-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 15px 30px rgba(255, 0, 0, 0.8);
            border-color: #ffff00;
        }

        .undertale-btn:hover::before {
            opacity: 1;
            left: 100%;
        }

        .undertale-btn:active {
            transform: scale(0.95);
        }

        .undertale-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: linear-gradient(45deg, #444444, #666666);
            border-color: #888888;
            color: #aaaaaa;
            transform: none !important;
            box-shadow: none !important;
        }

        .undertale-btn:disabled::before {
            display: none;
        }

        .battle-inventory {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 4px solid #ff4444;
            border-radius: 20px;
            padding: 30px;
            z-index: 10000;
            min-width: 400px;
            max-width: 500px;
            display: none;
        }

        .battle-inventory.active {
            display: block;
            animation: inventoryPopIn 0.5s ease;
        }

        @keyframes inventoryPopIn {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.8); 
            }
            100% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1); 
            }
        }

        .battle-inventory-title {
            color: #ff4444;
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(255, 68, 68, 0.7);
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .battle-inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .battle-inventory-slot {
            width: 80px;
            height: 80px;
            background: rgba(139, 0, 0, 0.3);
            border: 3px solid #8b0000;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .battle-inventory-slot:hover {
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
            transform: scale(1.1);
        }

        .battle-inventory-slot.has-item {
            background: rgba(255, 68, 68, 0.4);
            border-color: #ff4444;
        }

        .battle-inventory-item-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .battle-inventory-item-count {
            font-size: 0.8rem;
            color: #ffff00;
            font-weight: bold;
        }

        .battle-inventory-close {
            padding: 10px 20px;
            background: linear-gradient(45deg, #8b0000, #ff0000);
            border: 3px solid #ff4444;
            border-radius: 8px;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
            display: block;
            margin: 0 auto;
        }

        .battle-inventory-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 0, 0, 0.5);
        }

        .mobile-joystick {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.7);
            border: 4px solid #ff4444;
            border-radius: 50%;
            display: none;
            z-index: 10001;
            touch-action: none;
        }

        .mobile-joystick.active {
            display: block;
        }

        .joystick-knob {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #ff0000, #ff4444);
            border: 3px solid #ffff00;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
        }

        .mobile-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: none;
            flex-direction: column;
            gap: 15px;
            z-index: 10001;
        }

        .mobile-controls.active {
            display: flex;
        }

        .mobile-action-btn {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #8b0000, #ff0000);
            border: 4px solid #ff4444;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .mobile-action-btn:active {
            transform: scale(0.9);
            background: linear-gradient(45deg, #ff4444, #ff6666);
        }

        .mobile-action-btn:disabled {
            opacity: 0.4;
            background: linear-gradient(45deg, #444444, #666666);
            border-color: #888888;
        }

        .mobile-touch-feedback {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(255, 255, 0, 0.3), transparent);
            border-radius: 50%;
            pointer-events: none;
            z-index: 999;
            animation: touchRipple 0.6s ease-out forwards;
        }

        @keyframes touchRipple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
            }
            
            .shop-container, .notifications-container {
                max-height: 250px;
                padding: 15px;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .click-button {
                width: 250px;
                height: 250px;
                font-size: 5rem;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .undertale-btn {
                padding: 12px 20px;
                font-size: 1.2rem;
                min-width: 100px;
            }
            
            .battle-box {
                width: 90vw;
                height: 300px;
                max-width: 500px;
            }
            
            .boss-container {
                width: 95%;
                max-width: 500px;
            }
            
            .character-sprite {
                width: 100px;
                height: 130px;
            }
            
            .battle-inventory {
                width: 90vw;
                max-width: 400px;
                padding: 20px;
            }
            
            .battle-inventory-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .battle-inventory-slot {
                width: 70px;
                height: 70px;
            }
            
            .inventory-container {
                width: 250px;
                bottom: 180px;
                right: 15px;
            }
            
            .health-container {
                bottom: 180px;
                left: 15px;
            }
            
            .boss-dialogue {
                max-width: 90vw;
                font-size: 1rem;
            }
            
            .boss-actions {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 1.8rem;
            }
            
            .click-button {
                width: 200px;
                height: 200px;
                font-size: 4rem;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .battle-box {
                height: 250px;
            }
            
            .character-sprite {
                width: 80px;
                height: 100px;
            }
            
            .mobile-joystick {
                width: 100px;
                height: 100px;
                bottom: 20px;
                left: 20px;
            }
            
            .joystick-knob {
                width: 40px;
                height: 40px;
            }
            
            .mobile-controls {
                bottom: 20px;
                right: 20px;
            }
            
            .mobile-action-btn {
                width: 70px;
                height: 70px;
                font-size: 1.2rem;
            }
        }

        .fight-target {
            width: 100px;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid #ff4444;
            border-radius: 10px;
            position: relative;
            margin: 20px auto;
            overflow: hidden;
        }

        .fight-slider {
            width: 8px;
            height: 16px;
            background: #ffff00;
            border: 1px solid #ff0000;
            position: absolute;
            top: 1px;
            animation: slideAcross 2s linear infinite;
        }

        @keyframes slideAcross {
            0% { left: 0px; }
            100% { left: calc(100% - 8px); }
        }

        .fight-target-zone {
            width: 20px;
            height: 16px;
            background: rgba(0, 255, 0, 0.5);
            border: 1px solid #00ff00;
            position: absolute;
            top: 1px;
            left: 50%;
            transform: translateX(-50%);
        }

        .boss-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 700px;
            margin-bottom: 25px;
        }

        .character-sprite {
            width: 150px;
            height: 200px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border: 4px solid #8b0000;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.7);
            position: relative;
            animation: spriteFloat 3s ease-in-out infinite;
        }

        @keyframes spriteFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .dexter-sprite {
            background-image: url('dexter.png');
        }

        .trinity-sprite {
            background-image: url('trinity.png');
        }

        .ice-truck-sprite {
            background-image: url('ice-truck.png');
        }

        .travis-sprite {
            background-image: url('travis.png');
        }

        .lila-sprite {
            background-image: url('lila.png');
        }

        .boss-health-bar {
            width: 80%;
            max-width: 400px;
            height: 25px;
            background: rgba(139, 0, 0, 0.3);
            border: 3px solid #8b0000;
            border-radius: 12px;
            overflow: hidden;
            margin: 12px 0;
        }

        .boss-health {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff4444);
            width: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .boss-actions {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .boss-action-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, #8b0000, #ff0000);
            border: 3px solid #ff4444;
            border-radius: 8px;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .boss-action-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 0, 0, 0.7);
        }

        .boss-action-btn:active {
            transform: scale(0.95);
            animation: buttonStab 0.3s ease;
        }

        @keyframes buttonStab {
            0% { transform: scale(0.95); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(0.95); }
        }

        .boss-dialogue {
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #8b0000;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            max-width: 500px;
            text-align: center;
            font-size: 1.1rem;
            color: #ff4444;
            animation: dialoguePulse 2s ease infinite;
        }

        @keyframes dialoguePulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.5); }
            50% { box-shadow: 0 0 35px rgba(255, 68, 68, 0.8); }
        }

        .boss-special-effects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10000;
        }

        .boss-spark {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffff00;
            border-radius: 50%;
            animation: sparkFly 2s ease-out forwards;
        }

        @keyframes sparkFly {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.2) translateX(200px) translateY(-100px);
            }
        }

        .critical-number {
            color: #ffff00 !important;
            font-size: 2.8rem !important;
            text-shadow: 
                0 0 30px rgba(255, 255, 0, 1),
                0 0 60px rgba(255, 255, 0, 0.8),
                0 0 90px rgba(255, 255, 0, 0.6) !important;
            animation: criticalFloat 2.5s ease-out forwards !important;
            font-weight: bold !important;
        }

        @keyframes criticalFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }
            25% {
                transform: translateY(-15px) scale(1.6) rotate(8deg);
            }
            50% {
                transform: translateY(-30px) scale(1.4) rotate(-4deg);
            }
            75% {
                transform: translateY(-50px) scale(1.2) rotate(2deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1) rotate(0deg);
            }
        }

        .floating-number {
            position: absolute;
            color: #ff4444;
            font-weight: bold;
            font-size: 2rem;
            pointer-events: none;
            animation: normalFloat 2s ease-out forwards;
            text-shadow: 
                0 0 20px rgba(255, 68, 68, 1),
                0 0 40px rgba(255, 68, 68, 0.8);
            font-family: 'Courier New', monospace;
            z-index: 1000;
        }

        @keyframes normalFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }
            25% {
                transform: translateY(-12px) scale(1.3) rotate(5deg);
            }
            50% {
                transform: translateY(-25px) scale(1.2) rotate(-3deg);
            }
            75% {
                transform: translateY(-40px) scale(1.1) rotate(2deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(0.9) rotate(0deg);
            }
        }

        .screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.2);
            pointer-events: none;
            z-index: 999;
            opacity: 0;
            animation: flash 0.4s ease;
        }

        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .critical-flash {
            background: rgba(255, 255, 0, 0.4) !important;
            animation: criticalFlash 0.8s ease !important;
        }

        @keyframes criticalFlash {
            0%, 100% { opacity: 0; }
            25% { opacity: 1; }
            50% { opacity: 0.7; }
            75% { opacity: 1; }
        }

        .github-instructions {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #8b0000;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #cccccc;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .github-instructions h3 {
            color: #ff4444;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 68, 68, 0.7);
        }

        .github-instructions code {
            background: rgba(139, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            color: #ffaa44;
        }

        @media (max-width: 1200px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .shop-container, .notifications-container {
                max-height: 300px;
            }
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .click-button {
                width: 220px;
                height: 220px;
                font-size: 4.5rem;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">🔪 DEXTER'S LAB 🔪</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        <div class="loading-tip" id="loadingTip">Preparing your kill room...</div>
    </div>

    <div class="autosave-indicator" id="autosaveIndicator">
        💾 Game Auto-Saved Successfully
    </div>

    <div class="health-container">
        <div class="health-bar">
            <div class="health-fill" id="healthFill"></div>
        </div>
        <div class="health-text" id="healthText">Health: 100/100</div>
    </div>

    <div class="inventory-container">
        <div class="inventory-title">🎒 INVENTORY</div>
        <div class="inventory-grid" id="inventoryGrid"></div>
    </div>

    <div class="boss-special-effects" id="bossEffects"></div>

    <div class="boss-arena" id="bossArena">
        <div class="boss-container">
            <div class="character-sprite dexter-sprite" id="dexterSprite"></div>
            <div class="character-sprite" id="bossSprite"></div>
        </div>
        
        <div class="boss-health-bar">
            <div class="boss-health" id="bossHealth"></div>
        </div>
        
        <div class="boss-dialogue" id="bossDialogue">
            A dangerous killer approaches in the shadows...
        </div>

        <div class="fight-target" id="fightTarget" style="display: none;">
            <div class="fight-target-zone"></div>
            <div class="fight-slider" id="fightSlider"></div>
        </div>
        
        <div class="battle-box" id="battleBox">
            <div class="player-soul" id="playerSoul"></div>
        </div>
        
        <div class="undertale-buttons">
            <button class="undertale-btn" id="fightBtn" onclick="undertaleAction('fight')">⚔️ FIGHT</button>
            <button class="undertale-btn" id="talkBtn" onclick="undertaleAction('talk')">💬 TALK</button>
            <button class="undertale-btn" id="itemsBtn" onclick="undertaleAction('items')">🎒 ITEMS</button>
            <button class="undertale-btn" id="mercyBtn" onclick="undertaleAction('mercy')">🏃 ESCAPE</button>
        </div>
    </div>

    <div class="battle-inventory" id="battleInventory">
        <div class="battle-inventory-title">🎒 BATTLE ITEMS</div>
        <div class="battle-inventory-grid" id="battleInventoryGrid"></div>
        <button class="battle-inventory-close" onclick="closeBattleInventory()">✖️ CLOSE</button>
    </div>

    <div class="mobile-joystick" id="mobileJoystick">
        <div class="joystick-knob" id="joystickKnob"></div>
    </div>

    <div class="mobile-controls" id="mobileControls">
        <div class="mobile-action-btn" id="mobileFight" onclick="undertaleAction('fight')">⚔️</div>
        <div class="mobile-action-btn" id="mobileTalk" onclick="undertaleAction('talk')">💬</div>
        <div class="mobile-action-btn" id="mobileItems" onclick="undertaleAction('items')">🎒</div>
        <div class="mobile-action-btn" id="mobileEscape" onclick="undertaleAction('mercy')">🏃</div>
    </div>

    <div class="game-layout">
        <div class="shop-container">
            <div class="shop-title">🛒 SLY'S SHOP 🛒</div>
            
            <div class="shop-tabs">
                <div class="shop-tab active" onclick="switchTab('upgrades')">⚡ UPGRADES</div>
                <div class="shop-tab" onclick="switchTab('items')">🔪 ITEMS</div>
            </div>

            <div class="shop-content active" id="upgrades-content">
                <div class="upgrades">
                    <div class="upgrade" id="upgrade1">
                        <div class="upgrade-name">🔪 Razor's Edge</div>
                        <div class="upgrade-description">Sharper than a serpent's fang</div>
                        <div>+1 kill per click</div>
                        <div class="upgrade-cost">Cost: <span id="cost1">10</span> victims</div>
                    </div>
                    
                    <div class="upgrade" id="upgrade2">
                        <div class="upgrade-name">🗡️ Blood Harvester</div>
                        <div class="upgrade-description">Reaps souls with surgical precision</div>
                        <div>+5 kills per click</div>
                        <div class="upgrade-cost">Cost: <span id="cost2">100</span> victims</div>
                    </div>
                    
                    <div class="upgrade" id="upgrade3">
                        <div class="upgrade-name">💀 Soul Magnet</div>
                        <div class="upgrade-description">Attracts death automatically</div>
                        <div>+1 kill per second</div>
                        <div class="upgrade-cost">Cost: <span id="cost3">50</span> victims</div>
                    </div>
                    
                    <div class="upgrade" id="upgrade4">
                        <div class="upgrade-name">🏢 Death Factory</div>
                        <div class="upgrade-description">Mass production of demise</div>
                        <div>+10 kills per second</div>
                        <div class="upgrade-cost">Cost: <span id="cost4">500</span> victims</div>
                    </div>
                    
                    <div class="upgrade" id="upgrade5">
                        <div class="upgrade-name">⚡ Lightning Execution</div>
                        <div class="upgrade-description">Strike faster than thought</div>
                        <div>+25 kills per click</div>
                        <div class="upgrade-cost">Cost: <span id="cost5">2000</span> victims</div>
                    </div>
                    
                    <div class="upgrade" id="upgrade6">
                        <div class="upgrade-name">🌃 Night Reaper</div>
                        <div class="upgrade-description">Death walks in eternal darkness</div>
                        <div>+50 kills per second</div>
                        <div class="upgrade-cost">Cost: <span id="cost6">5000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade7">
                        <div class="upgrade-name">🧬 DNA Destroyer</div>
                        <div class="upgrade-description">Unravels life at its core</div>
                        <div>+100 kills per click</div>
                        <div class="upgrade-cost">Cost: <span id="cost7">10000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade8">
                        <div class="upgrade-name">🚢 Crimson Harbor</div>
                        <div class="upgrade-description">Where bodies find eternal rest</div>
                        <div>+200 kills per second</div>
                        <div class="upgrade-cost">Cost: <span id="cost8">25000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade9">
                        <div class="upgrade-name">👥 Trinity Protocol</div>
                        <div class="upgrade-description">Master the art of three</div>
                        <div>+500 kills per click</div>
                        <div class="upgrade-cost">Cost: <span id="cost9">50000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade10">
                        <div class="upgrade-name">🩸 Blood Archive</div>
                        <div class="upgrade-description">Memories preserved in crimson</div>
                        <div>+1000 kills per second</div>
                        <div class="upgrade-cost">Cost: <span id="cost10">100000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade11">
                        <div class="upgrade-name">🌊 Tidal Massacre</div>
                        <div class="upgrade-description">Waves of endless destruction</div>
                        <div>+2500 kills per click</div>
                        <div class="upgrade-cost">Cost: <span id="cost11">250000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade12">
                        <div class="upgrade-name">🎭 Code Eternal</div>
                        <div class="upgrade-description">Harry's legacy lives forever</div>
                        <div>+5000 kills per second</div>
                        <div class="upgrade-cost">Cost: <span id="cost12">500000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade13">
                        <div class="upgrade-name">🏥 Metro Morgue</div>
                        <div class="upgrade-description">Inside access to infinite victims</div>
                        <div>+10000 kills per click</div>
                        <div class="upgrade-cost">Cost: <span id="cost13">1000000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade14">
                        <div class="upgrade-name">🔥 Infernal Judge</div>
                        <div class="upgrade-description">Divine judgment through flames</div>
                        <div>+25000 kills per second</div>
                        <div class="upgrade-cost">Cost: <span id="cost14">2500000</span> victims</div>
                    </div>

                    <div class="upgrade" id="upgrade15">
                        <div class="upgrade-name">👁️ Omniscient Watcher</div>
                        <div class="upgrade-description">See all, judge all, end all</div>
                        <div>+50000 kills per click</div>
                        <div class="upgrade-cost">Cost: <span id="cost15">5000000</span> victims</div>
                    </div>
                </div>
            </div>

            <div class="shop-content" id="items-content">
                <div class="items">
                    <div class="item" id="item1">
                        <div class="item-name">🩹 Medical Bandage</div>
                        <div class="item-description">Heals wounds instantly</div>
                        <div>+25 Health when used</div>
                        <div class="item-cost">Cost: <span id="itemCost1">50</span> victims</div>
                    </div>

                    <div class="item" id="item2">
                        <div class="item-name">🔪 Steel Knife</div>
                        <div class="item-description">Sharp blade for precise cuts</div>
                        <div>+5 Click Power permanently</div>
                        <div class="item-cost">Cost: <span id="itemCost2">200</span> victims</div>
                    </div>

                    <div class="item" id="item3">
                        <div class="item-name">🗡️ Combat Blade</div>
                        <div class="item-description">Military-grade cutting tool</div>
                        <div>+20 Click Power permanently</div>
                        <div class="item-cost">Cost: <span id="itemCost3">1000</span> victims</div>
                    </div>

                    <div class="item" id="item4">
                        <div class="item-name">💉 Adrenaline Shot</div>
                        <div class="item-description">Boosts performance temporarily</div>
                        <div>+50% Click Power for 60 seconds</div>
                        <div class="item-cost">Cost: <span id="itemCost4">500</span> victims</div>
                    </div>

                    <div class="item" id="item5">
                        <div class="item-name">🩸 Blood Vial</div>
                        <div class="item-description">Contains essence of victims</div>
                        <div>+10% Critical Chance permanently</div>
                        <div class="item-cost">Cost: <span id="itemCost5">2000</span> victims</div>
                    </div>

                    <div class="item" id="item6">
                        <div class="item-name">⚔️ Legendary Blade</div>
                        <div class="item-description">Forged from pure evil</div>
                        <div>+100 Click Power permanently</div>
                        <div class="item-cost">Cost: <span id="itemCost6">10000</span> victims</div>
                    </div>

                    <div class="item" id="item7">
                        <div class="item-name">🏥 First Aid Kit</div>
                        <div class="item-description">Complete medical supplies</div>
                        <div>Full Health + 25 Max Health</div>
                        <div class="item-cost">Cost: <span id="itemCost7">5000</span> victims</div>
                    </div>

                    <div class="item" id="item8">
                        <div class="item-name">💀 Death's Scythe</div>
                        <div class="item-description">The ultimate weapon</div>
                        <div>+500 Click Power permanently</div>
                        <div class="item-cost">Cost: <span id="itemCost8">100000</span> victims</div>
                    </div>
                </div>
            </div>

            <div class="github-instructions">
                <h3>📁 GitHub PNG Setup Instructions:</h3>
                <p>To use custom PNG sprites instead of default ones:</p>
                <ol>
                    <li>Upload these PNG files to your GitHub repository:</li>
                    <ul>
                        <li><code>dexter.png</code> - Dexter Morgan sprite</li>
                        <li><code>trinity.png</code> - Trinity Killer sprite</li>
                        <li><code>ice-truck.png</code> - Ice Truck Killer sprite</li>
                        <li><code>travis.png</code> - Travis Marshall sprite</li>
                        <li><code>lila.png</code> - Lila West sprite</li>
                    </ul>
                    <li>Make sure images are <strong>150x200 pixels</strong> for best fit</li>
                    <li>The game will automatically load your PNG files</li>
                    <li>If PNG files are missing, it will show placeholder backgrounds</li>
                </ol>
                <p><strong>Pro Tip:</strong> Use transparent PNG backgrounds for best visual effect!</p>
            </div>
        </div>

        <div class="game-center">
            <div class="click-section">
                <button class="click-button" id="clickButton">🔪</button>
            </div>

            <div class="game-header">
                <h1 class="title">🔪 DEXTER'S LAB 🔪</h1>
                <div class="quote">
                    "Tonight's the night... and it's going to happen again and again."
                </div>
                
                <div class="save-load-controls">
                    <button class="save-btn" onclick="saveGame()">💾 SAVE GAME</button>
                    <button class="load-btn" onclick="loadGame()">📁 LOAD GAME</button>
                </div>
                
                <div class="stats">
                    <div class="stat">
                        <div>Victims</div>
                        <div class="stat-value" id="score">0</div>
                    </div>
                    <div class="stat">
                        <div>Kill Power</div>
                        <div class="stat-value" id="clickPower">1</div>
                    </div>
                    <div class="stat">
                        <div>Per Second</div>
                        <div class="stat-value" id="autoKills">0</div>
                    </div>
                    <div class="stat">
                        <div>Critical %</div>
                        <div class="stat-value" id="critChance">5</div>
                    </div>
                    <div class="stat">
                        <div>Boss Kills</div>
                        <div class="stat-value" id="bossKills">0</div>
                    </div>
                    <div class="stat">
                        <div>Body Parts</div>
                        <div class="stat-value" id="bodyParts">0</div>
                    </div>
                </div>

                <div class="target-section">
                    <div>🎯 Current Target: <span id="currentVictim">John Doe</span></div>
                    <div>🌙 Darkness Level: <span id="darknessLevel">1</span></div>
                </div>
            </div>
        </div>

        <div class="notifications-container">
            <div class="achievements-panel">
                <div class="achievements-title">🏆 ACHIEVEMENTS</div>
                <div id="achievements"></div>
            </div>

            <div class="boss-alerts-panel">
                <div class="boss-alerts-title">⚠️ BOSS ALERTS</div>
                <div id="bossAlerts"></div>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            score: 0,
            clickPower: 1,
            autoKills: 0,
            bodyParts: 0,
            criticalChance: 5,
            bossKills: 0,
            darknessLevel: 1,
            totalKills: 0,
            lastBossEncounter: 0,
            lastHardVictim: 0,
            health: 100,
            maxHealth: 100,
            upgrades: {},
            inventory: {},
            adrenalineBoost: 0,
            adrenalineEnd: 0
        };

        for (let i = 1; i <= 15; i++) {
            const baseCosts = [10, 100, 50, 500, 2000, 5000, 10000, 25000, 50000, 100000, 250000, 500000, 1000000, 2500000, 5000000];
            gameState.upgrades[`upgrade${i}`] = { 
                cost: baseCosts[i-1] || Math.pow(10, i), 
                owned: 0, 
                baseCost: baseCosts[i-1] || Math.pow(10, i) 
            };
        }

        const items = {
            item1: { name: 'Medical Bandage', icon: '🩹', cost: 50, type: 'consumable' },
            item2: { name: 'Steel Knife', icon: '🔪', cost: 200, type: 'permanent' },
            item3: { name: 'Combat Blade', icon: '🗡️', cost: 1000, type: 'permanent' },
            item4: { name: 'Adrenaline Shot', icon: '💉', cost: 500, type: 'consumable' },
            item5: { name: 'Blood Vial', icon: '🩸', cost: 2000, type: 'permanent' },
            item6: { name: 'Legendary Blade', icon: '⚔️', cost: 10000, type: 'permanent' },
            item7: { name: 'First Aid Kit', icon: '🏥', cost: 5000, type: 'consumable' },
            item8: { name: 'Deaths Scythe', icon: '💀', cost: 100000, type: 'permanent' }
        };

        let allAchievements = [];

        const bosses = {
            trinity: {
                name: "Trinity Killer",
                health: 800,
                maxHealth: 800,
                sprite: "trinity-sprite",
                dialogue: [
                    "Hello, Dexter morgan.",
                    "Its already over.",
                    "Your just like a kid.",
                    "Nice to meet you, Dexter Morgan.",
                    "The cycle of death must continue through me..."
                ],
                attacks: ['trinity_symbols', 'four_walls', 'divine_rain'],
                rewards: { score: 25000, clickPower: 400, critChance: 2 }
            },
            iceTruck: {
                name: "Ice Truck Killer",
                health: 600,
                maxHealth: 600,
                sprite: "ice-truck-sprite",
                dialogue: [
                    "Hey little brother.",
                    "You cant be a killer and a hero. It doesnt work that way!",
                    "Dex..",
                    "I didnt deserve this did i?.",
                    "You cannot escape your true nature..."
                ],
                attacks: ['ice_shards', 'frozen_limbs', 'cold_touch'],
                rewards: { score: 18000, clickPower: 250, critChance: 1.5 }
            },
            lila: {
                name: "Lila West",
                health: 500,
                maxHealth: 500,
                sprite: "lila-sprite",
                dialogue: [
                    "I know exactly who you really are, Dexter...",
                    "We're the same, you and me, creatures of darkness...",
                    "Let me help you embrace your true self...",
                    "Fire cleanses everything, including your lies...",
                    "You can't run from what you truly are..."
                ],
                attacks: ['fire_balls', 'flame_walls', 'burning_truth'],
                rewards: { score: 12000, clickPower: 180, critChance: 1 }
            }
        };

        let currentBoss = null;
        let battleState = 'menu';
        let playerSoulPos = { x: 290, y: 190 };
        let projectiles = [];
        let battlePhase = 0;
        let fightTimingActive = false;
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let joystickActive = false;
        let joystickCenter = { x: 0, y: 0 };
        let touchStartPos = { x: 0, y: 0 };

        const achievements = [
            { id: 'firstKill', name: 'First Blood 🔪', condition: (state) => state.score >= 1, unlocked: false },
            { id: 'criticalMaster', name: 'Critical Master ⚡', condition: (state) => state.criticalChance >= 30, unlocked: false },
            { id: 'serialKiller', name: 'Serial Killer 💀', condition: (state) => state.score >= 10, unlocked: false },
            { id: 'massMurderer', name: 'Mass Murderer 🩸', condition: (state) => state.score >= 100, unlocked: false },
            { id: 'bossHunter', name: 'Boss Hunter 👹', condition: (state) => state.bossKills >= 1, unlocked: false },
            { id: 'thousandKills', name: 'Thousand Souls 💀', condition: (state) => state.score >= 1000, unlocked: false },
            { id: 'darkLord', name: 'Dark Lord 🌑', condition: (state) => state.darknessLevel >= 10, unlocked: false },
            { id: 'bodyCollector', name: 'Body Collector 🫀', condition: (state) => state.bodyParts >= 1000, unlocked: false },
            { id: 'bossSlayer', name: 'Boss Slayer 👑', condition: (state) => state.bossKills >= 5, unlocked: false },
            { id: 'millionaire', name: 'Million Killer 💰', condition: (state) => state.score >= 1000000, unlocked: false },
            { id: 'survivor', name: 'Survivor 💚', condition: (state) => state.health >= 80, unlocked: false },
            { id: 'nearDeath', name: 'Near Death 💀', condition: (state) => state.health <= 10, unlocked: false },
            { id: 'collector', name: 'Item Collector 🎒', condition: (state) => Object.keys(state.inventory).length >= 5, unlocked: false }
        ];

        const victimNames = [
            "Arthur Mitchell", "Miguel Prado", "James Doakes", "Trinity Killer",
            "Hannah McKay", "Jordan Chase", "Travis Marshall", "Ice Truck Killer",
            "Oliver Saxon", "Kurt Caldwell", "Lila West", "Brian Moser",
            "Boyd Fowler", "Jeremy Downs", "Neil Perry", "Carlos Guerrero"
        ];

        const hardVictimNames = [
            "ARTHUR MITCHELL", "MIGUEL PRADO", "JORDAN CHASE", "TRAVIS MARSHALL",
            "OLIVER SAXON", "KURT CALDWELL", "BOYD FOWLER", "EUGENE GREER"
        ];

        const loadingTips = [
            "Tip: Click faster for more kills!",
            "Tip: Buy upgrades to increase your power!",
            "Tip: Critical hits deal massive damage!",
            "Tip: Boss fights give huge rewards!",
            "Tip: Don't let hard victims escape!",
            "Tip: Keep your health above 0 to survive!",
            "Tip: Use bandages to heal when low on health!",
            "Tip: Buy knives to permanently boost power!",
            "Tip: Inventory items can save your life!",
            "Tip: Auto-save happens every 15 seconds!"
        ];

        const scoreElement = document.getElementById('score');
        const clickPowerElement = document.getElementById('clickPower');
        const autoKillsElement = document.getElementById('autoKills');
        const critChanceElement = document.getElementById('critChance');
        const bossKillsElement = document.getElementById('bossKills');
        const bodyPartsElement = document.getElementById('bodyParts');
        const currentVictimElement = document.getElementById('currentVictim');
        const darknessLevelElement = document.getElementById('darknessLevel');
        const clickButton = document.getElementById('clickButton');
        const achievementsElement = document.getElementById('achievements');
        const bossAlertsElement = document.getElementById('bossAlerts');
        const autosaveIndicator = document.getElementById('autosaveIndicator');
        const healthFill = document.getElementById('healthFill');
        const healthText = document.getElementById('healthText');
        const inventoryGrid = document.getElementById('inventoryGrid');

        function initializeInventory() {
            for (let i = 0; i < 12; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                slot.id = `slot${i}`;
                slot.onclick = () => useInventoryItem(i);
                inventoryGrid.appendChild(slot);
            }
            updateInventoryDisplay();
        }

        function addToInventory(itemId) {
            const item = items[itemId];
            if (!gameState.inventory[itemId]) {
                gameState.inventory[itemId] = 0;
            }
            gameState.inventory[itemId]++;
            updateInventoryDisplay();
            showAchievement(`📦 Acquired ${item.name}! Check your inventory!`);
        }

        function updateInventoryDisplay() {
            const slots = document.querySelectorAll('.inventory-slot');
            slots.forEach(slot => {
                slot.innerHTML = '';
                slot.classList.remove('has-item');
            });

            let slotIndex = 0;
            Object.keys(gameState.inventory).forEach(itemId => {
                if (gameState.inventory[itemId] > 0 && slotIndex < 12) {
                    const slot = document.getElementById(`slot${slotIndex}`);
                    const item = items[itemId];
                    
                    slot.innerHTML = `
                        <div class="inventory-item-icon">${item.icon}</div>
                        <div class="inventory-item-count">${gameState.inventory[itemId]}</div>
                    `;
                    slot.classList.add('has-item');
                    slot.setAttribute('data-item', itemId);
                    slotIndex++;
                }
            });
        }

        function useInventoryItem(slotIndex) {
            const slot = document.getElementById(`slot${slotIndex}`);
            const itemId = slot.getAttribute('data-item');
            
            if (!itemId || !gameState.inventory[itemId] || gameState.inventory[itemId] <= 0) return;

            const item = items[itemId];
            
            switch(itemId) {
                case 'item1':
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + 25);
                    showAchievement('🩹 Used bandage! +25 Health!');
                    break;
                case 'item4':
                    gameState.adrenalineBoost = 0.5;
                    gameState.adrenalineEnd = Date.now() + 60000;
                    showAchievement('💉 Adrenaline activated! +50% power for 60s!');
                    break;
                case 'item7':
                    gameState.health = gameState.maxHealth;
                    gameState.maxHealth += 25;
                    showAchievement('🏥 Used First Aid Kit! Full health + max health!');
                    break;
            }

            if (item.type === 'consumable') {
                gameState.inventory[itemId]--;
                if (gameState.inventory[itemId] <= 0) {
                    delete gameState.inventory[itemId];
                }
            }
            
            updateInventoryDisplay();
            updateDisplay();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.shop-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.shop-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.shop-tab:nth-child(${tabName === 'upgrades' ? '1' : '2'})`).classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        function showLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingProgress = document.getElementById('loadingProgress');
            const loadingTip = document.getElementById('loadingTip');
            
            let progress = 0;
            let tipIndex = 0;
            
            const loadingInterval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress > 100) progress = 100;
                
                loadingProgress.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                    }, 500);
                }
            }, 200);
            
            const tipInterval = setInterval(() => {
                loadingTip.textContent = loadingTips[tipIndex];
                tipIndex = (tipIndex + 1) % loadingTips.length;
                
                if (progress >= 100) {
                    clearInterval(tipInterval);
                }
            }, 1000);
        }

        function showAutosaveIndicator() {
            autosaveIndicator.classList.add('show');
            setTimeout(() => {
                autosaveIndicator.classList.remove('show');
            }, 2000);
        }

        function updateHealthDisplay() {
            const healthPercent = (gameState.health / gameState.maxHealth) * 100;
            healthFill.style.width = healthPercent + '%';
            healthText.textContent = `Health: ${Math.floor(gameState.health)}/${gameState.maxHealth}`;
            
            if (gameState.health <= 0) {
                gameState.health = 0;
                showAchievement('💀 YOU DIED! Game will reset in 5 seconds...');
                setTimeout(() => {
                    resetGame();
                }, 5000);
            }
        }

        function resetGame() {
            gameState = {
                score: 0,
                clickPower: 1,
                autoKills: 0,
                bodyParts: 0,
                criticalChance: 5,
                bossKills: 0,
                darknessLevel: 1,
                totalKills: 0,
                lastBossEncounter: 0,
                lastHardVictim: 0,
                health: 100,
                maxHealth: 100,
                upgrades: {},
                inventory: {},
                adrenalineBoost: 0,
                adrenalineEnd: 0
            };
            
            for (let i = 1; i <= 15; i++) {
                const baseCosts = [10, 100, 50, 500, 2000, 5000, 10000, 25000, 50000, 100000, 250000, 500000, 1000000, 2500000, 5000000];
                gameState.upgrades[`upgrade${i}`] = { 
                    cost: baseCosts[i-1] || Math.pow(10, i), 
                    owned: 0, 
                    baseCost: baseCosts[i-1] || Math.pow(10, i) 
                };
            }
            
            achievements.forEach(achievement => achievement.unlocked = false);
            allAchievements = [];
            achievementsElement.innerHTML = '';
            updateDisplay();
            updateInventoryDisplay();
            showAchievement('🔄 Game Reset! Start your killing spree again!');
        }

        function autoSave() {
            localStorage.setItem('dexterInventoryFinalGameState', JSON.stringify(gameState));
            showAutosaveIndicator();
        }

        function isCriticalHit() {
            return Math.random() * 100 < gameState.criticalChance;
        }

        function getCurrentClickPower() {
            let power = gameState.clickPower;
            if (Date.now() < gameState.adrenalineEnd) {
                power *= (1 + gameState.adrenalineBoost);
            }
            return power;
        }

        function updateDisplay() {
            scoreElement.textContent = formatNumber(Math.floor(gameState.score));
            clickPowerElement.textContent = formatNumber(getCurrentClickPower());
            autoKillsElement.textContent = formatNumber(gameState.autoKills);
            critChanceElement.textContent = Math.floor(gameState.criticalChance);
            bossKillsElement.textContent = gameState.bossKills;
            bodyPartsElement.textContent = formatNumber(Math.floor(gameState.bodyParts));
            darknessLevelElement.textContent = gameState.darknessLevel;
            updateHealthDisplay();

            Object.keys(gameState.upgrades).forEach(upgradeId => {
                const upgrade = document.getElementById(upgradeId);
                if (upgrade) {
                    const cost = gameState.upgrades[upgradeId].cost;
                    
                    if (gameState.score >= cost) {
                        upgrade.classList.add('affordable');
                        upgrade.classList.remove('unaffordable');
                    } else {
                        upgrade.classList.remove('affordable');
                        upgrade.classList.add('unaffordable');
                    }
                }
            });

            Object.keys(items).forEach(itemId => {
                const item = document.getElementById(itemId);
                if (item) {
                    const cost = items[itemId].cost;
                    
                    if (gameState.score >= cost) {
                        item.classList.add('affordable');
                        item.classList.remove('unaffordable');
                    } else {
                        item.classList.remove('affordable');
                        item.classList.add('unaffordable');
                    }
                }
            });
        }

        function formatNumber(num) {
            if (num < 1000) return num.toString();
            if (num < 1000000) return (num / 1000).toFixed(1) + 'K';
            if (num < 1000000000) return (num / 1000000).toFixed(1) + 'M';
            if (num < 1000000000000) return (num / 1000000000).toFixed(1) + 'B';
            return (num / 1000000000000).toFixed(1) + 'T';
        }

        function checkBossEncounter() {
            const currentTime = Date.now();
            if (currentTime - gameState.lastBossEncounter > 12000) {
                if (Math.random() < 0.04) {
                    triggerBossEncounter();
                    gameState.lastBossEncounter = currentTime;
                }
            }
        }

        function checkHardVictim() {
            const currentTime = Date.now();
            if (currentTime - gameState.lastHardVictim > 6000) {
                if (Math.random() < 0.1) {
                    triggerHardVictim();
                    gameState.lastHardVictim = currentTime;
                }
            }
        }

        function triggerHardVictim() {
            const hardVictimName = hardVictimNames[Math.floor(Math.random() * hardVictimNames.length)];
            
            const hardVictimDiv = document.createElement('div');
            hardVictimDiv.className = 'hard-victim-alert';
            hardVictimDiv.innerHTML = `
                <div class="hard-victim-name">${hardVictimName}</div>
                <div style="margin: 12px 0; color: #cccccc; font-size: 1.1rem;">HARD VICTIM DETECTED! SPAM TO CAPTURE!</div>
                <button class="spam-button" onclick="spamVictim('${hardVictimName}', this.parentElement)">🔪 CAPTURE ${hardVictimName}!</button>
            `;
            
            document.body.appendChild(hardVictimDiv);
            
            let spamCount = 0;
            const requiredSpams = 12;
            let healthDrain = setInterval(() => {
                gameState.health -= 2.5;
                updateHealthDisplay();
                
                if (gameState.health <= 0 || spamCount >= requiredSpams) {
                    clearInterval(healthDrain);
                    if (document.body.contains(hardVictimDiv)) {
                        hardVictimDiv.remove();
                    }
                }
            }, 400);
            
            setTimeout(() => {
                clearInterval(healthDrain);
                if (document.body.contains(hardVictimDiv)) {
                    hardVictimDiv.remove();
                    if (spamCount < requiredSpams) {
                        showAchievement('💔 Hard victim escaped! Health penalty!');
                        gameState.health -= 12;
                        updateHealthDisplay();
                    }
                }
            }, 6000);
            
            hardVictimDiv.spamCount = 0;
            hardVictimDiv.requiredSpams = requiredSpams;
            hardVictimDiv.healthDrain = healthDrain;
        }

        function spamVictim(victimName, alertDiv) {
            if (!alertDiv.spamCount) alertDiv.spamCount = 0;
            alertDiv.spamCount++;
            
            const spamButton = alertDiv.querySelector('.spam-button');
            spamButton.textContent = `🔪 CAPTURE! (${alertDiv.spamCount}/${alertDiv.requiredSpams})`;
            
            if (alertDiv.spamCount >= alertDiv.requiredSpams) {
                clearInterval(alertDiv.healthDrain);
                
                const reward = gameState.clickPower * 40;
                gameState.score += reward;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + 15);
                
                showAchievement(`💰 Captured ${victimName}! +${formatNumber(reward)} victims & +15 health!`);
                
                alertDiv.remove();
                updateDisplay();
            }
        }

        function triggerBossEncounter() {
            const bossKeys = Object.keys(bosses);
            const randomBoss = bossKeys[Math.floor(Math.random() * bossKeys.length)];
            currentBoss = { ...bosses[randomBoss], key: randomBoss };
            
            showBossAlert();
        }

        function showBossAlert() {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'boss-encounter-alert';
            alertDiv.innerHTML = `
                <div class="boss-name">${currentBoss.name.toUpperCase()} DETECTED!</div>
                <div style="margin: 10px 0; color: #cccccc; font-size: 0.9rem;">A legendary serial killer stalks the shadows!</div>
                <button class="boss-alert-btn" onclick="acceptBossFight()">🩸 HUNT THEM DOWN</button>
                <button class="boss-alert-btn" onclick="declineBossFight()">👻 IGNORE FOR NOW</button>
            `;
            
            bossAlertsElement.appendChild(alertDiv);
            
            setTimeout(() => {
                if (bossAlertsElement.contains(alertDiv)) {
                    alertDiv.remove();
                    currentBoss = null;
                }
            }, 7000);
        }

        function acceptBossFight() {
            const bossArena = document.getElementById('bossArena');
            const bossSprite = document.getElementById('bossSprite');
            const bossHealth = document.getElementById('bossHealth');
            const bossDialogue = document.getElementById('bossDialogue');
            const battleBox = document.getElementById('battleBox');
            const fightTarget = document.getElementById('fightTarget');
            const battleInventory = document.getElementById('battleInventory');
            
            bossAlertsElement.innerHTML = '';
            
            battleBox.innerHTML = '<div class="player-soul" id="playerSoul"></div>';
            
            fightTarget.style.display = 'none';
            battleInventory.classList.remove('active');
            fightTimingActive = false;
            
            document.removeEventListener('keydown', handleBattleInput);
            
            bossArena.classList.add('active');
            
            if (isMobile) {
                showMobileControls();
            }
            
            bossSprite.className = `character-sprite ${currentBoss.sprite}`;
            bossHealth.style.width = '100%';
            bossDialogue.textContent = currentBoss.dialogue[0];
            
            battleState = 'menu';
            playerSoulPos = { x: 290, y: 190 };
            projectiles = [];
            battlePhase = 0;
            
            updatePlayerSoulPosition();
            enableUndertaleButtons();
            setupBattleControls();
        }

        function setupBattleControls() {
            document.addEventListener('keydown', handleBattleInput);
        }

        function handleBattleInput(e) {
            if (!document.getElementById('bossArena').classList.contains('active')) return;
            
            const speed = 6;
            
            switch(e.key.toLowerCase()) {
                case 'w':
                case 'arrowup':
                    if (playerSoulPos.y > 20) playerSoulPos.y -= speed;
                    break;
                case 's':
                case 'arrowdown':
                    if (playerSoulPos.y < 360) playerSoulPos.y += speed;
                    break;
                case 'a':
                case 'arrowleft':
                    if (playerSoulPos.x > 20) playerSoulPos.x -= speed;
                    break;
                case 'd':
                case 'arrowright':
                    if (playerSoulPos.x < 560) playerSoulPos.x += speed;
                    break;
                case ' ':
                    if (fightTimingActive) {
                        checkFightTiming();
                    }
                    break;
            }
            
            playerSoulPos.x = Math.max(20, Math.min(560, playerSoulPos.x));
            playerSoulPos.y = Math.max(20, Math.min(360, playerSoulPos.y));
            
            updatePlayerSoulPosition();
            e.preventDefault();
        }

        function updatePlayerSoulPosition() {
            const playerSoul = document.getElementById('playerSoul');
            playerSoul.style.left = playerSoulPos.x + 'px';
            playerSoul.style.top = playerSoulPos.y + 'px';
        }

        function undertaleAction(action) {
            if (battleState === 'attacking') return;
            
            const bossDialogue = document.getElementById('bossDialogue');
            
            disableUndertaleButtons();
            
            switch(action) {
                case 'fight':
                    startFightSequence();
                    break;
                case 'talk':
                    const randomDialogue = currentBoss.dialogue[Math.floor(Math.random() * currentBoss.dialogue.length)];
                    bossDialogue.textContent = randomDialogue;
                    setTimeout(() => {
                        startBossAttack();
                    }, 2000);
                    break;
                case 'items':
                    openBattleInventory();
                    enableUndertaleButtons();
                    break;
                case 'mercy':
                    bossDialogue.textContent = "You attempt to escape the deadly encounter...";
                    setTimeout(() => {
                        escapeBoss();
                    }, 2000);
                    break;
            }
        }

        function disableUndertaleButtons() {
            document.getElementById('fightBtn').disabled = true;
            document.getElementById('talkBtn').disabled = true;
            document.getElementById('itemsBtn').disabled = true;
            document.getElementById('mercyBtn').disabled = true;
        }

        function enableUndertaleButtons() {
            document.getElementById('fightBtn').disabled = false;
            document.getElementById('talkBtn').disabled = false;
            document.getElementById('itemsBtn').disabled = false;
            document.getElementById('mercyBtn').disabled = false;
        }

        function openBattleInventory() {
            const battleInventory = document.getElementById('battleInventory');
            const battleInventoryGrid = document.getElementById('battleInventoryGrid');
            
            battleInventoryGrid.innerHTML = '';
            
            let slotIndex = 0;
            Object.keys(gameState.inventory).forEach(itemId => {
                if (gameState.inventory[itemId] > 0 && slotIndex < 8) {
                    const item = items[itemId];
                    
                    const slot = document.createElement('div');
                    slot.className = 'battle-inventory-slot has-item';
                    slot.setAttribute('data-item', itemId);
                    slot.onclick = () => useBattleItem(itemId);
                    
                    slot.innerHTML = `
                        <div class="battle-inventory-item-icon">${item.icon}</div>
                        <div class="battle-inventory-item-count">${gameState.inventory[itemId]}</div>
                    `;
                    
                    battleInventoryGrid.appendChild(slot);
                    slotIndex++;
                }
            });
            
            while (slotIndex < 8) {
                const emptySlot = document.createElement('div');
                emptySlot.className = 'battle-inventory-slot';
                battleInventoryGrid.appendChild(emptySlot);
                slotIndex++;
            }
            
            battleInventory.classList.add('active');
        }

        function closeBattleInventory() {
            const battleInventory = document.getElementById('battleInventory');
            battleInventory.classList.remove('active');
        }

        function useBattleItem(itemId) {
            if (!gameState.inventory[itemId] || gameState.inventory[itemId] <= 0) return;
            
            const item = items[itemId];
            const bossDialogue = document.getElementById('bossDialogue');
            
            switch(itemId) {
                case 'item1':
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + 25);
                    bossDialogue.textContent = '🩹 Used bandage in battle! +25 Health!';
                    break;
                case 'item4':
                    gameState.adrenalineBoost = 0.5;
                    gameState.adrenalineEnd = Date.now() + 60000;
                    bossDialogue.textContent = '💉 Adrenaline coursing through your veins! +50% power!';
                    break;
                case 'item7':
                    gameState.health = gameState.maxHealth;
                    gameState.maxHealth += 25;
                    bossDialogue.textContent = '🏥 First aid in the heat of battle! Full recovery!';
                    break;
                default:
                    bossDialogue.textContent = `You used ${item.name} but nothing happened in battle...`;
                    break;
            }

            if (item.type === 'consumable') {
                gameState.inventory[itemId]--;
                if (gameState.inventory[itemId] <= 0) {
                    delete gameState.inventory[itemId];
                }
            }
            
            updateDisplay();
            updateInventoryDisplay();
            closeBattleInventory();
            
            setTimeout(() => {
                startBossAttack();
            }, 2000);
        }

        function startFightSequence() {
            const fightTarget = document.getElementById('fightTarget');
            const bossDialogue = document.getElementById('bossDialogue');
            
            fightTarget.style.display = 'block';
            fightTimingActive = true;
            bossDialogue.textContent = "Press SPACE when the slider hits the green zone!";
            
            setTimeout(() => {
                if (fightTimingActive) {
                    fightTimingActive = false;
                    fightTarget.style.display = 'none';
                    bossDialogue.textContent = "You missed the timing!";
                    setTimeout(startBossAttack, 1500);
                }
            }, 3000);
        }

        function checkFightTiming() {
            const slider = document.getElementById('fightSlider');
            const sliderRect = slider.getBoundingClientRect();
            const targetZone = document.querySelector('.fight-target-zone');
            const targetRect = targetZone.getBoundingClientRect();
            
            const sliderCenter = sliderRect.left + sliderRect.width / 2;
            const targetCenter = targetRect.left + targetRect.width / 2;
            const distance = Math.abs(sliderCenter - targetCenter);
            
            fightTimingActive = false;
            document.getElementById('fightTarget').style.display = 'none';
            
            let damage = 0;
            const bossDialogue = document.getElementById('bossDialogue');
            
            if (distance < 15) {
                damage = getCurrentClickPower() * 4;
                bossDialogue.textContent = "PERFECT HIT! Critical damage dealt!";
                createBossEffects();
            } else if (distance < 30) {
                damage = getCurrentClickPower() * 2.5;
                bossDialogue.textContent = "Good hit! Solid damage!";
            } else {
                damage = getCurrentClickPower() * 1;
                bossDialogue.textContent = "You barely grazed them...";
            }
            
            currentBoss.health -= damage;
            
            const bossHealth = document.getElementById('bossHealth');
            const healthPercent = Math.max(0, (currentBoss.health / currentBoss.maxHealth) * 100);
            bossHealth.style.width = healthPercent + '%';
            
            if (currentBoss.health <= 0) {
                setTimeout(defeatedBoss, 2000);
            } else {
                setTimeout(startBossAttack, 2000);
            }
        }

        function startBossAttack() {
            const battleBox = document.getElementById('battleBox');
            const attackType = currentBoss.attacks[Math.floor(Math.random() * currentBoss.attacks.length)];
            
            battleState = 'attacking';
            projectiles = [];
            battlePhase++;
            
            switch(attackType) {
                case 'trinity_symbols':
                    createTrinityAttack();
                    break;
                case 'four_walls':
                    createWallAttack();
                    break;
                case 'divine_rain':
                    createRainAttack();
                    break;
                case 'ice_shards':
                    createIceAttack();
                    break;
                case 'frozen_limbs':
                    createFrozenAttack();
                    break;
                case 'cold_touch':
                    createColdAttack();
                    break;
                case 'fire_balls':
                    createFireAttack();
                    break;
                case 'flame_walls':
                    createFlameWallAttack();
                    break;
                case 'burning_truth':
                    createBurningAttack();
                    break;
            }
            
            startProjectilePhase();
        }

        function createTrinityAttack() {
            const battleBox = document.getElementById('battleBox');
            const bossDialogue = document.getElementById('bossDialogue');
            bossDialogue.textContent = "Divine symbols rain from the heavens!";
            
            for (let wave = 0; wave < 3; wave++) {
                setTimeout(() => {
                    for (let i = 0; i < 6; i++) {
                        setTimeout(() => {
                            const projectile = document.createElement('div');
                            projectile.className = 'boss-projectile trinity-symbol';
                            projectile.style.left = (i * 100 + 50 + Math.random() * 50) + 'px';
                            projectile.style.top = '-40px';
                            battleBox.appendChild(projectile);
                            
                            projectiles.push({
                                element: projectile,
                                x: parseFloat(projectile.style.left),
                                y: -40,
                                vx: (Math.random() - 0.5) * 3,
                                vy: 4 + Math.random() * 3,
                                rotation: 0,
                                rotationSpeed: 5
                            });
                        }, i * 100);
                    }
                }, wave * 800);
            }
        }

        function createIceAttack() {
            const battleBox = document.getElementById('battleBox');
            const bossDialogue = document.getElementById('bossDialogue');
            bossDialogue.textContent = "Frozen blades pierce through the air!";
            
            for (let side = 0; side < 2; side++) {
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        const projectile = document.createElement('div');
                        projectile.className = 'boss-projectile ice-shard';
                        
                        if (side === 0) {
                            projectile.style.left = '-50px';
                            projectile.style.top = (i * 50 + 20) + 'px';
                        } else {
                            projectile.style.left = '650px';
                            projectile.style.top = (i * 50 + 20) + 'px';
                        }
                        
                        battleBox.appendChild(projectile);
                        
                        const targetX = playerSoulPos.x;
                        const targetY = playerSoulPos.y;
                        const startX = side === 0 ? -50 : 650;
                        const startY = parseFloat(projectile.style.top);
                        
                        const angle = Math.atan2(targetY - startY, targetX - startX);
                        const speed = 5;
                        
                        projectiles.push({
                            element: projectile,
                            x: startX,
                            y: startY,
                            vx: Math.cos(angle) * speed,
                            vy: Math.sin(angle) * speed,
                            trail: []
                        });
                    }, i * 150 + side * 75);
                }
            }
        }

        function createFireAttack() {
            const battleBox = document.getElementById('battleBox');
            const bossDialogue = document.getElementById('bossDialogue');
            bossDialogue.textContent = "Infernal flames seek your soul!";
            
            const centerX = 300;
            const centerY = 200;
            const radius = 150;
            
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const projectile = document.createElement('div');
                    projectile.className = 'boss-projectile fire-ball';
                    
                    const angle = (i / 12) * Math.PI * 2;
                    const startX = centerX + Math.cos(angle) * radius;
                    const startY = centerY + Math.sin(angle) * radius;
                    
                    projectile.style.left = startX + 'px';
                    projectile.style.top = startY + 'px';
                    battleBox.appendChild(projectile);
                    
                    const speed = 3 + Math.random() * 2;
                    
                    projectiles.push({
                        element: projectile,
                        x: startX,
                        y: startY,
                        vx: Math.cos(angle) * -speed,
                        vy: Math.sin(angle) * -speed,
                        orbiting: true,
                        orbitAngle: angle,
                        orbitSpeed: 0.05
                    });
                }, i * 200);
            }
            
            setTimeout(() => {
                for (let j = 0; j < 8; j++) {
                    setTimeout(() => {
                        const chasingBall = document.createElement('div');
                        chasingBall.className = 'boss-projectile fire-ball';
                        chasingBall.style.left = Math.random() * 600 + 'px';
                        chasingBall.style.top = '-50px';
                        battleBox.appendChild(chasingBall);
                        
                        projectiles.push({
                            element: chasingBall,
                            x: parseFloat(chasingBall.style.left),
                            y: -50,
                            vx: 0,
                            vy: 0,
                            chasing: true,
                            speed: 2.5
                        });
                    }, j * 300);
                }
            }, 2000);
        }

        function createWallAttack() {
            const battleBox = document.getElementById('battleBox');
            const bossDialogue = document.getElementById('bossDialogue');
            bossDialogue.textContent = "Four walls converge to entomb you!";
            
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const wall = document.createElement('div');
                    wall.className = 'boss-projectile trinity-symbol';
                    wall.style.width = '15px';
                    wall.style.height = '400px';
                    
                    if (i < 4) {
                        wall.style.left = (i * 150 - 50) + 'px';
                        wall.style.top = '0px';
                    } else {
                        wall.style.left = ((i - 4) * 150 + 650) + 'px';
                        wall.style.top = '0px';
                    }
                    
                    battleBox.appendChild(wall);
                    
                    const speed = 3;
                    
                    projectiles.push({
                        element: wall,
                        x: parseFloat(wall.style.left),
                        y: 0,
                        vx: i < 4 ? speed : -speed,
                        vy: 0,
                        isWall: true
                    });
                }, i * 200);
            }
        }

        function createRainAttack() {
            const battleBox = document.getElementById('battleBox');
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const projectile = document.createElement('div');
                    projectile.className = 'boss-projectile trinity-symbol';
                    projectile.style.left = Math.random() * 560 + 'px';
                    projectile.style.top = '-40px';
                    battleBox.appendChild(projectile);
                    
                    projectiles.push({
                        element: projectile,
                        x: parseFloat(projectile.style.left),
                        y: -40,
                        vx: 0,
                        vy: 5
                    });
                }, i * 150);
            }
        }

        function createFrozenAttack() {
            createIceAttack();
        }

        function createColdAttack() {
            const battleBox = document.getElementById('battleBox');
            for (let i = 0; i < 12; i++) {
                const projectile = document.createElement('div');
                projectile.className = 'boss-projectile ice-shard';
                const angle = (i / 12) * Math.PI * 2;
                const radius = 200;
                const centerX = 300;
                const centerY = 200;
                
                projectile.style.left = (centerX + Math.cos(angle) * radius) + 'px';
                projectile.style.top = (centerY + Math.sin(angle) * radius) + 'px';
                battleBox.appendChild(projectile);
                
                projectiles.push({
                    element: projectile,
                    x: centerX + Math.cos(angle) * radius,
                    y: centerY + Math.sin(angle) * radius,
                    vx: Math.cos(angle) * -2,
                    vy: Math.sin(angle) * -2
                });
            }
        }

        function createFlameWallAttack() {
            createFireAttack();
        }

        function createBurningAttack() {
            createFireAttack();
        }

        function startProjectilePhase() {
            const projectileInterval = setInterval(() => {
                if (battleState === 'escaped' || battleState === 'victory' || !currentBoss) {
                    clearInterval(projectileInterval);
                    projectiles.forEach(proj => {
                        if (proj.element && proj.element.parentNode) {
                            proj.element.remove();
                        }
                    });
                    projectiles = [];
                    return;
                }
                
                updateProjectiles();
                checkCollisions();
                
                if (projectiles.length === 0) {
                    clearInterval(projectileInterval);
                    setTimeout(() => {
                        if (battleState !== 'escaped' && battleState !== 'victory' && currentBoss) {
                            battleState = 'menu';
                            enableUndertaleButtons();
                            document.getElementById('bossDialogue').textContent = "Your turn! Choose your action!";
                        }
                    }, 1000);
                }
            }, 50);
            
            setTimeout(() => {
                clearInterval(projectileInterval);
                projectiles.forEach(proj => {
                    if (proj.element && proj.element.parentNode) {
                        proj.element.remove();
                    }
                });
                projectiles = [];
                if (battleState !== 'escaped' && battleState !== 'victory' && currentBoss) {
                    battleState = 'menu';
                    enableUndertaleButtons();
                    document.getElementById('bossDialogue').textContent = "Your turn! Choose your action!";
                }
            }, 5000);
        }

        function updateProjectiles() {
            projectiles = projectiles.filter(proj => {
                if (!proj.element || !proj.element.parentNode) return false;
                
                if (proj.chasing) {
                    const dx = playerSoulPos.x - proj.x;
                    const dy = playerSoulPos.y - proj.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 0) {
                        proj.vx = (dx / distance) * proj.speed;
                        proj.vy = (dy / distance) * proj.speed;
                    }
                }
                
                if (proj.orbiting) {
                    proj.orbitAngle += proj.orbitSpeed;
                    const centerX = 300;
                    const centerY = 200;
                    const radius = 100;
                    proj.x = centerX + Math.cos(proj.orbitAngle) * radius;
                    proj.y = centerY + Math.sin(proj.orbitAngle) * radius;
                } else {
                    proj.x += proj.vx;
                    proj.y += proj.vy;
                }
                
                if (proj.rotation !== undefined) {
                    proj.rotation += proj.rotationSpeed;
                    proj.element.style.transform = `rotate(${proj.rotation}deg)`;
                }
                
                proj.element.style.left = proj.x + 'px';
                proj.element.style.top = proj.y + 'px';
                
                if (proj.x < -100 || proj.x > 700 || proj.y < -100 || proj.y > 500) {
                    proj.element.remove();
                    return false;
                }
                
                return true;
            });
        }

        function checkCollisions() {
            if (battleState === 'victory' || battleState === 'escaped' || !currentBoss) return;
            
            const soulRect = {
                x: playerSoulPos.x,
                y: playerSoulPos.y,
                width: 20,
                height: 20
            };
            
            projectiles.forEach(proj => {
                const projRect = {
                    x: proj.x,
                    y: proj.y,
                    width: proj.element.offsetWidth,
                    height: proj.element.offsetHeight
                };
                
                if (soulRect.x < projRect.x + projRect.width &&
                    soulRect.x + soulRect.width > projRect.x &&
                    soulRect.y < projRect.y + projRect.height &&
                    soulRect.y + soulRect.height > projRect.y) {
                    
                    gameState.health -= 15;
                    updateHealthDisplay();
                    
                    const playerSoul = document.getElementById('playerSoul');
                    if (playerSoul) {
                        playerSoul.style.background = '#ffffff';
                        setTimeout(() => {
                            if (playerSoul) {
                                playerSoul.style.background = '#ff0000';
                            }
                        }, 200);
                    }
                    
                    proj.element.remove();
                    const index = projectiles.indexOf(proj);
                    if (index > -1) projectiles.splice(index, 1);
                }
            });
        }

        function declineBossFight() {
            bossAlertsElement.innerHTML = '';
            currentBoss = null;
        }

        function createBossEffects() {
            const effectsContainer = document.getElementById('bossEffects');
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const spark = document.createElement('div');
                    spark.className = 'boss-spark';
                    spark.style.left = Math.random() * 100 + '%';
                    spark.style.top = Math.random() * 100 + '%';
                    effectsContainer.appendChild(spark);
                    
                    setTimeout(() => {
                        spark.remove();
                    }, 2000);
                }, i * 200);
            }
        }

        function defeatedBoss() {
            const bossArena = document.getElementById('bossArena');
            
            battleState = 'victory';
            
            projectiles.forEach(proj => {
                if (proj.element && proj.element.parentNode) {
                    proj.element.remove();
                }
            });
            projectiles = [];
            
            gameState.score += currentBoss.rewards.score;
            gameState.clickPower += currentBoss.rewards.clickPower;
            gameState.criticalChance += currentBoss.rewards.critChance;
            gameState.bossKills++;
            gameState.health = Math.min(gameState.maxHealth, gameState.health + 50);
            
            showAchievement(`🎉 Defeated ${currentBoss.name}! 👑 Massive power boost!`);
            
            createBossEffects();
            createBossEffects();
            createBossEffects();
            
            setTimeout(() => {
                document.removeEventListener('keydown', handleBattleInput);
                bossArena.classList.remove('active');
                currentBoss = null;
                battleState = 'menu';
                updateDisplay();
                checkAchievements();
            }, 3000);
        }

        function escapeBoss() {
            const bossArena = document.getElementById('bossArena');
            const battleBox = document.getElementById('battleBox');
            const fightTarget = document.getElementById('fightTarget');
            const battleInventory = document.getElementById('battleInventory');
            
            battleState = 'escaped';
            fightTimingActive = false;
            
            projectiles.forEach(proj => {
                if (proj.element && proj.element.parentNode) {
                    proj.element.remove();
                }
            });
            projectiles = [];
            
            battleBox.innerHTML = '<div class="player-soul" id="playerSoul"></div>';
            
            fightTarget.style.display = 'none';
            battleInventory.classList.remove('active');
            
            enableUndertaleButtons();
            hideMobileControls();
            
            document.removeEventListener('keydown', handleBattleInput);
            
            setTimeout(() => {
                bossArena.classList.remove('active');
                currentBoss = null;
                battleState = 'menu';
                playerSoulPos = { x: 290, y: 190 };
                updatePlayerSoulPosition();
            }, 1000);
            
            showAchievement('You escaped into the shadows... this time. 🏃');
        }

        clickButton.addEventListener('click', (e) => {
            const isCrit = isCriticalHit();
            let kills = getCurrentClickPower();
            
            if (isCrit) {
                kills *= 4;
                clickButton.classList.add('critical-hit');
                setTimeout(() => clickButton.classList.remove('critical-hit'), 1000);
            }
            
            gameState.score += kills;
            gameState.totalKills += kills;
            gameState.bodyParts += kills * 0.2;
            gameState.darknessLevel = Math.floor(gameState.totalKills / 100) + 1;
            
            if (gameState.criticalChance < 60) {
                gameState.criticalChance += 0.02;
            }
            
            createScreenFlash(isCrit);
            createFloatingNumber(e, kills, isCrit);
            
            if (Math.random() < 0.7) {
                currentVictimElement.textContent = victimNames[Math.floor(Math.random() * victimNames.length)];
            }
            
            updateDisplay();
            checkAchievements();
        });

        function createScreenFlash(isCritical = false) {
            const flash = document.createElement('div');
            flash.className = isCritical ? 'screen-flash critical-flash' : 'screen-flash';
            document.body.appendChild(flash);
            
            setTimeout(() => {
                if (document.body.contains(flash)) {
                    document.body.removeChild(flash);
                }
            }, isCritical ? 800 : 400);
        }

        function createFloatingNumber(event, value, isCritical = false) {
            const floatingNumber = document.createElement('div');
            floatingNumber.className = isCritical ? 'floating-number critical-number' : 'floating-number';
            floatingNumber.textContent = (isCritical ? 'MEGA CRIT! +' : '+') + formatNumber(value);
            floatingNumber.style.left = (event.clientX + Math.random() * 120 - 60) + 'px';
            floatingNumber.style.top = (event.clientY + Math.random() * 120 - 60) + 'px';
            
            if (!isCritical) {
                const colors = ['#ff4444', '#ff6666', '#ff8888', '#ffaaaa'];
                floatingNumber.style.color = colors[Math.floor(Math.random() * colors.length)];
            }
            
            document.body.appendChild(floatingNumber);
            
            setTimeout(() => {
                if (document.body.contains(floatingNumber)) {
                    document.body.removeChild(floatingNumber);
                }
            }, isCritical ? 2500 : 2000);
        }

        function showAchievement(name) {
            const achievementDiv = document.createElement('div');
            achievementDiv.className = 'achievement';
            achievementDiv.innerHTML = `🏆 ${name}`;
            
            allAchievements.push(achievementDiv);
            achievementsElement.appendChild(achievementDiv);
        }

        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!achievement.unlocked && achievement.condition(gameState)) {
                    achievement.unlocked = true;
                    showAchievement(achievement.name);
                }
            });
        }

        const upgradeEffects = {
            upgrade1: () => gameState.clickPower += 1,
            upgrade2: () => gameState.clickPower += 5,
            upgrade3: () => gameState.autoKills += 1,
            upgrade4: () => gameState.autoKills += 10,
            upgrade5: () => gameState.clickPower += 25,
            upgrade6: () => gameState.autoKills += 50,
            upgrade7: () => gameState.clickPower += 100,
            upgrade8: () => gameState.autoKills += 200,
            upgrade9: () => gameState.clickPower += 500,
            upgrade10: () => gameState.autoKills += 1000,
            upgrade11: () => gameState.clickPower += 2500,
            upgrade12: () => gameState.autoKills += 5000,
            upgrade13: () => gameState.clickPower += 10000,
            upgrade14: () => gameState.autoKills += 25000,
            upgrade15: () => gameState.clickPower += 50000
        };

        Object.keys(upgradeEffects).forEach(upgradeId => {
            const element = document.getElementById(upgradeId);
            if (element) {
                element.addEventListener('click', () => buyUpgrade(upgradeId, upgradeEffects[upgradeId]));
            }
        });

        function buyUpgrade(upgradeId, effect) {
            const upgrade = gameState.upgrades[upgradeId];
            if (gameState.score >= upgrade.cost) {
                gameState.score -= upgrade.cost;
                upgrade.owned++;
                effect();
                
                gameState.criticalChance += 0.8;
                
                upgrade.cost = Math.floor(upgrade.baseCost * Math.pow(1.15, upgrade.owned));
                const costElement = document.getElementById(upgradeId.replace('upgrade', 'cost'));
                if (costElement) {
                    costElement.textContent = formatNumber(upgrade.cost);
                }
                
                updateDisplay();
                showPurchaseEffect(upgradeId);
            }
        }

        function showPurchaseEffect(upgradeId) {
            const upgrade = document.getElementById(upgradeId);
            upgrade.style.transform = 'scale(1.15)';
            upgrade.style.boxShadow = '0 0 50px rgba(255, 0, 0, 1)';
            
            setTimeout(() => {
                upgrade.style.transform = '';
                upgrade.style.boxShadow = '';
            }, 600);
        }

        Object.keys(items).forEach(itemId => {
            const element = document.getElementById(itemId);
            if (element) {
                element.addEventListener('click', () => buyItem(itemId));
            }
        });

        function buyItem(itemId) {
            const item = items[itemId];
            if (gameState.score >= item.cost) {
                gameState.score -= item.cost;
                
                if (item.type === 'permanent') {
                    switch(itemId) {
                        case 'item2':
                            gameState.clickPower += 5;
                            showAchievement('🔪 Steel Knife acquired! +5 Click Power!');
                            break;
                        case 'item3':
                            gameState.clickPower += 20;
                            showAchievement('🗡️ Combat Blade acquired! +20 Click Power!');
                            break;
                        case 'item5':
                            gameState.criticalChance += 10;
                            showAchievement('🩸 Blood Vial used! +10% Critical Chance!');
                            break;
                        case 'item6':
                            gameState.clickPower += 100;
                            showAchievement('⚔️ Legendary Blade acquired! +100 Click Power!');
                            break;
                        case 'item8':
                            gameState.clickPower += 500;
                            showAchievement('💀 Deaths Scythe acquired! +500 Click Power!');
                            break;
                    }
                } else {
                    addToInventory(itemId);
                }
                
                updateDisplay();
                showPurchaseEffect(itemId);
                checkAchievements();
            }
        }

        function saveGame() {
            localStorage.setItem('dexterInventoryFinalGameState', JSON.stringify(gameState));
            showAchievement('Game Saved Successfully! 💾');
        }

        function loadGame() {
            const savedGame = localStorage.getItem('dexterInventoryFinalGameState');
            if (savedGame) {
                try {
                    gameState = { ...gameState, ...JSON.parse(savedGame) };
                    updateDisplay();
                    updateInventoryDisplay();
                    showAchievement('Game Loaded Successfully! 📁');
                } catch (e) {
                    showAchievement('Load Failed! ❌');
                }
            } else {
                showAchievement('No Save Found! ❌');
            }
        }

        setInterval(() => {
            if (gameState.autoKills > 0) {
                gameState.score += gameState.autoKills;
                gameState.totalKills += gameState.autoKills;
                gameState.bodyParts += gameState.autoKills * 0.1;
                gameState.darknessLevel = Math.floor(gameState.totalKills / 100) + 1;
                updateDisplay();
                checkAchievements();
            }
        }, 1000);

        setInterval(() => {
            checkBossEncounter();
        }, 2500);

        setInterval(() => {
            checkHardVictim();
        }, 1500);

        setInterval(autoSave, 15000);

        window.addEventListener('load', () => {
            showLoadingScreen();
            initializeInventory();
            currentVictimElement.textContent = victimNames[Math.floor(Math.random() * victimNames.length)];
            updateDisplay();
            
            const savedGame = localStorage.getItem('dexterInventoryFinalGameState');
            if (savedGame) {
                try {
                    gameState = { ...gameState, ...JSON.parse(savedGame) };
                    updateDisplay();
                    updateInventoryDisplay();
                } catch (e) {
                    console.log('Could not load saved game');
                }
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'X') {
                gameState.score += 1000000;
                gameState.clickPower += 10000;
                gameState.health = gameState.maxHealth;
                updateDisplay();
                showAchievement('Ultimate Cheat Activated! 🎮');
            }
        });

        function showMobileControls() {
            const mobileJoystick = document.getElementById('mobileJoystick');
            const mobileControls = document.getElementById('mobileControls');
            
            mobileJoystick.classList.add('active');
            mobileControls.classList.add('active');
            
            setupJoystick();
            updateMobileButtonStates();
        }

        function hideMobileControls() {
            const mobileJoystick = document.getElementById('mobileJoystick');
            const mobileControls = document.getElementById('mobileControls');
            
            mobileJoystick.classList.remove('active');
            mobileControls.classList.remove('active');
            
            joystickActive = false;
        }

        function setupJoystick() {
            const joystick = document.getElementById('mobileJoystick');
            const knob = document.getElementById('joystickKnob');
            
            const joystickRect = joystick.getBoundingClientRect();
            joystickCenter.x = joystickRect.width / 2;
            joystickCenter.y = joystickRect.height / 2;
            
            joystick.addEventListener('touchstart', (e) => {
                e.preventDefault();
                joystickActive = true;
                const touch = e.touches[0];
                const rect = joystick.getBoundingClientRect();
                touchStartPos.x = touch.clientX - rect.left;
                touchStartPos.y = touch.clientY - rect.top;
            });
            
            joystick.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!joystickActive) return;
                
                const touch = e.touches[0];
                const rect = joystick.getBoundingClientRect();
                const touchX = touch.clientX - rect.left;
                const touchY = touch.clientY - rect.top;
                
                const dx = touchX - joystickCenter.x;
                const dy = touchY - joystickCenter.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const maxDistance = joystickCenter.x - 25;
                
                if (distance > maxDistance) {
                    const angle = Math.atan2(dy, dx);
                    const limitedX = joystickCenter.x + Math.cos(angle) * maxDistance;
                    const limitedY = joystickCenter.y + Math.sin(angle) * maxDistance;
                    knob.style.left = limitedX - 25 + 'px';
                    knob.style.top = limitedY - 25 + 'px';
                } else {
                    knob.style.left = touchX - 25 + 'px';
                    knob.style.top = touchY - 25 + 'px';
                }
                
                const speed = 6;
                const moveX = (dx / maxDistance) * speed;
                const moveY = (dy / maxDistance) * speed;
                
                playerSoulPos.x += moveX;
                playerSoulPos.y += moveY;
                
                playerSoulPos.x = Math.max(20, Math.min(560, playerSoulPos.x));
                playerSoulPos.y = Math.max(20, Math.min(360, playerSoulPos.y));
                
                updatePlayerSoulPosition();
            });
            
            joystick.addEventListener('touchend', (e) => {
                e.preventDefault();
                joystickActive = false;
                knob.style.left = '50%';
                knob.style.top = '50%';
                knob.style.transform = 'translate(-50%, -50%)';
            });
        }

        function updateMobileButtonStates() {
            const mobileFight = document.getElementById('mobileFight');
            const mobileTalk = document.getElementById('mobileTalk');
            const mobileItems = document.getElementById('mobileItems');
            const mobileEscape = document.getElementById('mobileEscape');
            
            const isDisabled = battleState === 'attacking';
            
            mobileFight.disabled = isDisabled;
            mobileTalk.disabled = isDisabled;
            mobileItems.disabled = isDisabled;
            mobileEscape.disabled = isDisabled;
        }

        function disableUndertaleButtons() {
            document.getElementById('fightBtn').disabled = true;
            document.getElementById('talkBtn').disabled = true;
            document.getElementById('itemsBtn').disabled = true;
            document.getElementById('mercyBtn').disabled = true;
            
            if (isMobile) {
                updateMobileButtonStates();
            }
        }

        function enableUndertaleButtons() {
            document.getElementById('fightBtn').disabled = false;
            document.getElementById('talkBtn').disabled = false;
            document.getElementById('itemsBtn').disabled = false;
            document.getElementById('mercyBtn').disabled = false;
            
            if (isMobile) {
                updateMobileButtonStates();
            }
        }

        function createTouchFeedback(x, y) {
            const feedback = document.createElement('div');
            feedback.className = 'mobile-touch-feedback';
            feedback.style.left = (x - 30) + 'px';
            feedback.style.top = (y - 30) + 'px';
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                if (document.body.contains(feedback)) {
                    document.body.removeChild(feedback);
                }
            }, 600);
        }

        if (isMobile) {
            document.addEventListener('touchstart', (e) => {
                const touch = e.touches[0];
                createTouchFeedback(touch.clientX, touch.clientY);
            });
            
            clickButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                clickButton.click();
            });
            
            document.querySelectorAll('.mobile-action-btn').forEach(btn => {
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (!btn.disabled) {
                        btn.click();
                    }
                });
            });
        }
    </script>
</body>
</html></parameter>
</invoke>
